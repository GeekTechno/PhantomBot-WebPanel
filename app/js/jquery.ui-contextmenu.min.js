(function(factory){"use strict";if(typeof define==="function"&&define.amd){define(["jquery.ui-contextmenu"],factory)}else{factory(jQuery)}})(function($){"use strict";var supportSelectstart="onselectstart"in document.createElement("div"),match,uiVersion;$.widget("moogle.contextmenu",{version:"@VERSION",options:{autoTrigger:true,delegate:null,hide:{effect:"fadeOut",duration:"fast"},ignoreParentSelect:true,menu:null,position:null,preventContextMenuForPopup:false,preventSelect:false,show:{effect:"slideDown",duration:"fast"},taphold:false,uiMenuOptions:{},beforeOpen:$.noop,blur:$.noop,close:$.noop,create:$.noop,createMenu:$.noop,focus:$.noop,open:$.noop,select:$.noop},_create:function(){var cssText,eventNames,targetId,opts=this.options;this.$headStyle=null;this.$menu=null;this.menuIsTemp=false;this.currentTarget=null;if(opts.preventSelect){targetId=($(this.element).is(document)?$("body"):this.element).uniqueId().attr("id");cssText="#"+targetId+" "+opts.delegate+" { "+"-webkit-user-select: none; "+"-khtml-user-select: none; "+"-moz-user-select: none; "+"-ms-user-select: none; "+"user-select: none; "+"}";this.$headStyle=$("<style class='moogle-contextmenu-style' />").prop("type","text/css").appendTo("head");try{this.$headStyle.html(cssText)}catch(e){this.$headStyle[0].styleSheet.cssText=cssText}if(supportSelectstart){this.element.delegate(opts.delegate,"selectstart"+this.eventNamespace,function(event){event.preventDefault()})}}this._createUiMenu(opts.menu);eventNames="contextmenu"+this.eventNamespace;if(opts.taphold){eventNames+=" taphold"+this.eventNamespace}this.element.delegate(opts.delegate,eventNames,$.proxy(this._openMenu,this))},_destroy:function(){this.element.undelegate(this.eventNamespace);this._createUiMenu(null);if(this.$headStyle){this.$headStyle.remove();this.$headStyle=null}},_createUiMenu:function(menuDef){var ct;if(this.isOpen()){ct=this.currentTarget;this._closeMenu(true);this.currentTarget=ct}if(this.menuIsTemp){this.$menu.remove()}else if(this.$menu){this.$menu.menu("destroy").hide()}this.$menu=null;this.menuIsTemp=false;if(!menuDef){return}else if($.isArray(menuDef)){this.$menu=$.moogle.contextmenu.createMenuMarkup(menuDef);this.menuIsTemp=true}else if(typeof menuDef==="string"){this.$menu=$(menuDef)}else{this.$menu=menuDef}this.$menu.hide().menu($.extend(true,{},this.options.uiMenuOptions,{blur:$.proxy(this.options.blur,this),create:$.proxy(this.options.createMenu,this),focus:$.proxy(this.options.focus,this),select:$.proxy(function(event,ui){var retval,isParent=$.moogle.contextmenu.isMenu(ui.item),actionHandler=ui.item.data("actionHandler");ui.cmd=ui.item.attr("data-command");ui.target=$(this.currentTarget);if(!isParent||!this.options.ignoreParentSelect){retval=this._trigger.call(this,"select",event,ui);if(actionHandler){retval=actionHandler.call(this,event,ui)}if(retval!==false){this._closeMenu.call(this)}event.preventDefault()}},this)}))},_openMenu:function(event){var opts=this.options,posOption=opts.position,self=this,manualTrigger=!!event.isTrigger,ui={menu:this.$menu,target:$(event.target),extraData:event.extraData,originalEvent:event};if(!opts.autoTrigger&&!manualTrigger){return}this.currentTarget=event.target;event.preventDefault();if(this._trigger("beforeOpen",event,ui)===false){this.currentTarget=null;return false}ui.menu=this.$menu;$(document).bind("keydown"+this.eventNamespace,function(event){if(event.which===$.ui.keyCode.ESCAPE){self._closeMenu()}}).bind("mousedown"+this.eventNamespace+" touchstart"+this.eventNamespace,function(event){if(!$(event.target).closest(".ui-menu-item").length){self._closeMenu()}});if($.isFunction(posOption)){posOption=posOption(event,ui)}posOption=$.extend({my:"left top",at:"left bottom",of:event.pageX===undefined?event.target:event,collision:"fit"},posOption);this.$menu.show().css({position:"absolute",left:0,top:0}).position(posOption).hide();if(opts.preventContextMenuForPopup){this.$menu.bind("contextmenu"+this.eventNamespace,function(event){event.preventDefault()})}this._show(this.$menu,this.options.show,function(){self._trigger.call(self,"open",event,ui)})},_closeMenu:function(immediately){var self=this,hideOpts=immediately?false:this.options.hide;$(document).unbind("mousedown"+this.eventNamespace).unbind("touchstart"+this.eventNamespace).unbind("keydown"+this.eventNamespace);this.$menu.unbind("contextmenu"+this.eventNamespace);self.currentTarget=null;this._hide(this.$menu,hideOpts,function(){self._trigger("close")})},_setOption:function(key,value){switch(key){case"menu":this.replaceMenu(value);break}$.Widget.prototype._setOption.apply(this,arguments)},_getMenuEntry:function(cmd){return this.$menu.find("li[data-command="+cmd+"]")},close:function(){if(this.isOpen()){this._closeMenu()}},enableEntry:function(cmd,flag){this._getMenuEntry(cmd).toggleClass("ui-state-disabled",flag===false)},getMenu:function(){return this.$menu},isOpen:function(){return!!this.$menu&&!!this.currentTarget},open:function(target,extraData){extraData=extraData||{};var e=jQuery.Event("contextmenu",{target:target.get(0),extraData:extraData});return this.element.trigger(e)},replaceMenu:function(data){this._createUiMenu(data)},setEntry:function(cmd,titleOrData){var $entry=this._getMenuEntry(cmd);if(typeof titleOrData==="string"){$.moogle.contextmenu.updateTitle($entry,titleOrData)}else{$entry.empty();titleOrData.cmd=titleOrData.cmd||cmd;$.moogle.contextmenu.createEntryMarkup(titleOrData,$entry)}},showEntry:function(cmd,flag){this._getMenuEntry(cmd).toggle(flag!==false)}});$.extend($.moogle.contextmenu,{createMenuMarkup:function(options,$parentUl){var i,menu,$ul,$li;if($parentUl==null){$parentUl=$("<ul class='ui-helper-hidden' />").appendTo("body")}for(i=0;i<options.length;i++){menu=options[i];$li=$("<li/>").appendTo($parentUl);$.moogle.contextmenu.createEntryMarkup(menu,$li);if($.isArray(menu.children)){$ul=$("<ul/>").appendTo($li);$.moogle.contextmenu.createMenuMarkup(menu.children,$ul)}}return $parentUl},replaceFirstTextNodeChild:function(elem,text){elem.contents().filter(function(){return this.nodeType===3}).first().replaceWith(text)}});match=$.ui.menu.version.match(/^(\d)\.(\d+)/);uiVersion={major:parseInt(match[1],10),minor:parseInt(match[2],10)};if(uiVersion.major<2&&uiVersion.minor<11){$.extend($.moogle.contextmenu,{createEntryMarkup:function(entry,$parentLi){var $a=null;if(!/[^\-\u2014\u2013\s]/.test(entry.title)){$parentLi.text(entry.title)}else{$parentLi.attr("data-command",entry.cmd);$a=$("<a/>",{html:""+entry.title,href:"#"}).appendTo($parentLi);if($.isFunction(entry.action)){$parentLi.data("actionHandler",entry.action)}if(entry.uiIcon){$a.append($("<span class='ui-icon' />").addClass(entry.uiIcon))}if(entry.disabled){$parentLi.addClass("ui-state-disabled")}if($.isPlainObject(entry.data)){$a.data(entry.data)}}},isMenu:function(item){return item.has(">a[aria-haspopup='true']").length>0},updateTitle:function(item,title){$.moogle.contextmenu.replaceFirstTextNodeChild($("a",item),title)}})}else{$.extend($.moogle.contextmenu,{createEntryMarkup:function(entry,$parentLi){if(!/[^\-\u2014\u2013\s]/.test(entry.title)){$parentLi.text(entry.title)}else{$parentLi.attr("data-command",entry.cmd).html(""+entry.title);if($.isFunction(entry.action)){$parentLi.data("actionHandler",entry.action)}if(entry.uiIcon){$parentLi.append($("<span class='ui-icon' />").addClass(entry.uiIcon))}if(entry.disabled){$parentLi.addClass("ui-state-disabled")}if($.isPlainObject(entry.data)){$parentLi.data(entry.data)}}},isMenu:function(item){return item.is("[aria-haspopup='true']")},updateTitle:function(item,title){$.moogle.contextmenu.replaceFirstTextNodeChild(item,title)}})}});
//# sourceMappingURL=jquery.ui-contextmenu.min.js.map