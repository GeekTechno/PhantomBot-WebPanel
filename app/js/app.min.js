function addSecondChat(){var t=$("#second-chat-form-input");""!=t.val()&&$("#chat-sidebar").addClass("double-chat").append('<iframe id="chat-iframe-secondary" src="http://www.twitch.tv/'+t.val().toLocaleLowerCase()+'/chat?popout=" scrolling="no"></iframe>')}function applyChannelData(t){null!=t.stream&&($("#stream-status").text("Online"),t.stream.hasOwnProperty("viewers")||(t.stream.viewers=0),$("#stream-viewer-count").text(t.stream.viewers)),$("#stream-title").text(t.channel.status),t.channel.hasOwnProperty("game")||(t.channel.game=""),$("#stream-game").text(t.channel.game),t.followers.hasOwnProperty("_total")||(t.followers._total=0),$("#stream-followers").text(t.followers._total),doBotRequest("getIniValueByKey",function(t){"0"!=t&&$("#stream-hosts").text(data[0])},{uri:"stream_info",key:"hosts_amount"})}function bindGlobalEventHandlers(){$(".dropdown-toggle").on("click",function(){var t,e=$(this),a=e.next(".dropdown-menu"),o=300;"block"==a.css("display")?a.fadeOut(o):($(".dropdown-menu").fadeOut(o),a.hasClass("drop-up")?a.fadeIn(o):a.fadeIn(o).on("click mouseleave",function(){t=setTimeout(function(){a.fadeOut(o).off("click mouseleave mouseenter")},300)}).on("mouseenter",function(){clearTimeout(t)}))}),$("#music-player-divide-volume").on("change",function(){pBotData.musicPlayerControls.volumeDivision=$(this).is(":checked"),pBotStorage.set(pBotStorage.keys.musicPlayer.volumeDivisionEnabled,pBotData.musicPlayerControls.volumeDivision),setMusicPlayerVolume(pBotData.musicPlayerControls.volume,!0)})}function bindPartEventHandlers(){$("form").off("submit").on("submit",function(t){var e;t.target.attributes.hasOwnProperty("botcommand")||(t.target.attributes.botcommand={value:""});var a=$(t.target[0]),o=t.target.attributes.formnoreload.value;0!=a.val().length?(e=""==t.target.attributes.botcommand.value?{command:_cleanInput(a.val())}:{command:_cleanInput(t.target.attributes.botcommand.value)+" "+_cleanInput(a.val())},doBotRequest("command",function(e){showGeneralAlert(e,"success"),debug(o,t.target.attributes),"1"==o?a.val(""):loadPartFromStorage()},e)):showGeneralAlert(),t.preventDefault()}),$(".collapsible-master").on("click",function(){var t=$(this),e=t.next(".collapsible-content");if(t.hasClass("open")){e.fadeOut(300);for(var a in pBotData.touchedCollapsibles)pBotData.touchedCollapsibles[a]==t.text()&&pBotData.touchedCollapsibles.splice(a,1)}else e.fadeIn(300),pBotData.touchedCollapsibles.push(t.text());t.toggleClass("open")}),$("#stream-preview").on("load",calculateStreamHeight);for(var t in pBotData.touchedCollapsibles)$(".collapsible-master:contains("+pBotData.touchedCollapsibles[t]+")").toggleClass("open").next(".collapsible-content").fadeIn(300);toggleTooltips(!0),toggleInformationPanels(!0)}function calculateStreamHeight(t){var e;e=t?$(t.currentTarget):$("#stream-preview"),e.height(.5625*e.outerWidth()+30)}function channelDataCache(t){return t?(t.pbotCacheEndTime=Date.now()+3e5,void pBotStorage.set(pBotStorage.keys.twitchCache,t)):pBotStorage.get(pBotStorage.keys.twitchCache,!1)}function clearSecondChat(){$("#chat-iframe-secondary").remove(),$("#chat-sidebar").removeClass("double-chat"),$("#second-chat-form-input").val("")}function doBotRequest(t,e,a){pBotData.config.isBotOnline&&$.ajax({type:"POST",url:"/app/php/connect.php",data:$.extend({action:t},a,pBotData.login),dataType:"json",success:function(t){200==t[1]?e&&e.apply(this,[t[0],t[1]]):(showGeneralAlert("Bot Request failed!"),console.log("Bot Request failed...",t))}})}function doQuickCommand(t,e,a){(!e||""==e||confirm(e))&&doBotRequest("command",function(t){showGeneralAlert(t,"success"),a||loadPartFromStorage()},{command:_cleanInput(t)})}function getPanelConfig(){$.ajax({type:"POST",url:"/app/php/connect.php",data:$.extend({action:"getConfig"},pBotData.login),dataType:"json",success:function(t){200==t[1]?(pBotData.config=t[0],loadChannelData(),toggleMusicPlayerControls(!0,$("#player-controls-toggle")),toggleTooltips(!0),setMusicPlayerVolume(pBotData.musicPlayerControls.volume,!0,!0),toggleChat(!0,$("#toggle-chat"))):showLoginAlert(t[3])}})}function loadChannelData(t){var e=channelDataCache();if(!t&&e&&e.pbotCacheEndTime>Date.now())console.log("Stream info loaded from local cache!",e),applyChannelData(e);else{var a={stream:null,channel:null,followers:null};$.ajax({url:"https://api.twitch.tv/kraken/channels/"+pBotData.config.owner+"/follows?limit=1",type:"GET",dataType:"json",success:function(t){a.followers=t,$.ajax({url:"https://api.twitch.tv/kraken/streams/"+pBotData.config.owner,type:"GET",dataType:"json",success:function(t){null!=t.stream?(a.stream=t.stream,a.channel=t.stream.channel,channelDataCache(a),applyChannelData(a)):$.ajax({url:"https://api.twitch.tv/kraken/channels/"+pBotData.config.owner,type:"GET",dataType:"json",success:function(t){a.channel=t,channelDataCache(a),applyChannelData(a)}})}})}})}}function loadPartFromStorage(){var t=pBotStorage.get(pBotStorage.keys.lastUsedPart,"static/dashboard.php");setActiveMenuItem(t),$("#part-window").load("/app/parts/"+t,bindPartEventHandlers)}function logOut(){var t=0;for(t;3>t;t++)localStorage.removeItem(pBotStorage.keys[t]);location.replace("/")}function openPart(t,e){pBotData.touchedCollapsibles=[],setActiveMenuItem(t),e?$("#part-window").load("/app/parts/"+t,e,bindPartEventHandlers):$("#part-window").load("/app/parts/"+t,bindPartEventHandlers),pBotStorage.set(pBotStorage.keys.lastUsedPart,t)}function saveToConfig(t,e,a){var o=$("#"+e).val();doBotRequest("saveToConfig",function(t){console.log(t),$(a).removeClass("btn-primary").addClass("btn-success").text("Saved").prop("disabled",!0);var e=setTimeout(function(){$(a).removeClass("btn-success").addClass("btn-primary").text("Save").prop("disabled",!1),clearTimeout(e)},3e3)},{settingPath:t,setting:o.trim()})}function setActiveMenuItem(t){$(".active").removeClass("active"),$("#menu-parent-"+t.replace("static/","").replace(/([a-z]+).*/i,"$1")).addClass("active"),$("#menu-favorites-"+t.replace(/.*\/([^-]+).*\.php/i,"$1")).addClass("active")}function setBotStatus(){$.ajax({type:"POST",url:"/app/php/connect.php",data:$.extend({action:"testBotConnection"},pBotData.login),dataType:"json",success:function(t){52==t[2]?pBotData.config.isBotOnline=!0:console.warn("Bot is offline!\nDisabling bot requests...\nChecking again in 10 minutes...\n"+t[3])}})}function setMusicPlayerVolume(t,e,a){var o,n;if(o=e?t:pBotData.musicPlayerControls.volume+t,o>=0&&100>=o){if(pBotData.musicPlayerControls.volume=o,$("#music-player-volume").find(".value").css({"background-position":"center "+pBotData.musicPlayerControls.volume+"%"}),a&&pBotStorage.get(pBotStorage.keys.musicPlayer.lastVolumeUpdate,0)<Date.now()+864e5)return;n=setTimeout(function(){pBotStorage.set(pBotStorage.keys.musicPlayer.lastVolumeUpdate,Date.now()),pBotStorage.set(pBotStorage.keys.musicPlayer.volume,pBotData.musicPlayerControls.volume),doQuickCommand(pBotData.musicPlayerControls.volumeDivision?"volume "+pBotData.musicPlayerControls.volume/10:"volume "+pBotData.musicPlayerControls.volume),clearTimeout(n)},500)}}function showGeneralAlert(t,e){t||(t="You forgot to enter a value!"),e||(e="danger"),$("#general-alert").addClass("alert-"+e).text(t).fadeIn(300);var a=setTimeout(function(){$("#general-alert").fadeOut(700),clearTimeout(a)},2e3)}function toggleInformationPanels(t){var e=$(".information-panel");t?e.toggleClass("hidden",!pBotData.informationActive):(pBotData.informationActive=!pBotData.informationActive,e.toggleClass("hidden",pBotData.informationActive),pBotStorage.set(pBotStorage.keys.informationActive,pBotData.informationActive),loadPartFromStorage())}function toggleMusicPlayerControls(t,e){t?$("#music-player-divide-volume").prop({checked:pBotData.musicPlayerControls.volumeDivision}):(pBotData.musicPlayerControls.controlsEnabled=!pBotData.musicPlayerControls.controlsEnabled,pBotStorage.set(pBotStorage.keys.musicPlayer.controlsEnabled,pBotData.musicPlayerControls.controlsEnabled));var a=$("body"),o="music-controls-enabled";pBotData.musicPlayerControls.controlsEnabled?(a.addClass(o),pBotData.musicPlayerControls.updateIntervalId=setInterval(updateMusicPlayerState,5e3),$(e).html('<span class="fa fa-eject text-success"></span>&nbsp;Hide Music Player Controls')):(-1!=pBotData.musicPlayerControls.updateIntervalId&&clearInterval(pBotData.musicPlayerControls.updateIntervalId),a.removeClass(o),$(e).html('<span class="fa fa-eject"></span>&nbsp;Show Music Player Controls'))}function toggleStreamPreview(t){if(void 0!=t)return void(pBotData.streamPreviewActive=!1);var e=$("#stream-preview");pBotData.streamPreviewActive?(pBotData.streamPreviewActive=!1,e.removeClass("open").attr("src","")):(pBotData.streamPreviewActive=!0,e.addClass("open").attr("src","http://twitch.tv/"+pBotData.config.owner+"/embed")),$("#stream-preview-fit-video").toggle(pBotData.streamPreviewActive)}function toggleTooltips(t){t?bindTooltips(pBotData.tooltipsActive):(bindTooltips(pBotData.tooltipsActive),pBotData.tooltipsActive=!pBotData.tooltipsActive,pBotStorage.set(pBotStorage.keys.tooltipsActive,pBotData.tooltipsActive),loadPartFromStorage())}function toggleChat(t,e){var a=$("body"),o=$("#chat-iframe"),n="chat-enabled",s=a.hasClass(n);return t?void(pBotStorage.get(pBotStorage.keys.chatDefaultState)&&(a.addClass(n),o.attr("src","http://www.twitch.tv/"+pBotData.config.owner+"/chat?popout="),$(e).html('<span class="fa fa-eject text-success"></span>&nbsp;Hide Chat'))):void(s?(a.removeClass(n),o.attr("src",""),$(e).html('<span class="fa fa-eject"></span>&nbsp;Show Chat')):(a.addClass(n),o.attr("src","http://www.twitch.tv/"+pBotData.config.owner+"/chat?popout="),$(e).html('<span class="fa fa-eject text-success"></span>&nbsp;Hide Chat')))}function toggleChatDefaultState(){var t=!pBotStorage.get(pBotStorage.keys.chatDefaultState);pBotStorage.set(pBotStorage.keys.chatDefaultState,t)}function updateFavoritesMenu(t,e){var a=pBotStorage.get(pBotStorage.keys.favoritesMenuItems,[]);if(t&&e){var o;for(var n in a)a[n].itemName==t&&(o=!0,a.splice(n,1));o||a.push({itemName:t,itemPath:e}),pBotStorage.set(pBotStorage.keys.favoritesMenuItems,a),setTimeout(updateFavoritesMenu,10)}else{var s=$("#favorites-menu");s.children(".favorites-item").each(function(t,e){$(e).remove()});for(n in a)s.append($('<li class="favorites-item" id="menu-favorites-'+a[n].itemName.toLocaleLowerCase()+'"><a nohref onclick="openPart(\''+a[n].itemPath+'\')" role="button">'+a[n].itemName+"</a></li>"))}}function updateMusicPlayerState(){pBotData.musicPlayerControls.controlsEnabled&&(doBotRequest("getCurrentTitle",function(t){var e=$("#current-video-title"),a=t;9*a.length>e.width()?(e.find(".text").html("&nbsp;"+a+_repeat("&nbsp;",10)),e.addClass("long")):(e.find(".text:first-child").html("&nbsp;"+a),e.removeClass("long"))}),doBotRequest("getMusicPlayerPlaylist",function(t){$("#music-player-requests").html(t)}))}function _repeat(t,e){var a="",o=0;for(o;e>o;o++)a+=t;return a}function _cleanInput(t){var e=[/^!/],a=[""],o=0;for(o;o<e.length-1;o++)t.replace(e[o],a[o]);return t}function debug(){console.log.apply(console,arguments)}var pBotStorage={keys:{twitchCache:"pbot-twitch-cache",chatDefaultState:"pbot-chat-state",lastUsedPart:"pbot-last-used-part",panelLogin:"pbot-login",favoritesMenuItems:"pbot-favorites-menu-items",informationActive:"pbot-information-active",tooltipsActive:"pbot-tooltips-active",musicPlayer:{volume:"pbot-music-player-volume",controlsEnabled:"pbot-music-player-controls",volumeDivisionEnabled:"pbot-music-player-volume-division",lastVolumeUpdate:"pbot-music-player-last-update"}},set:function(t,e){localStorage.setItem(t,JSON.stringify(e))},get:function(t,e){return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):e?e:!1}},pBotData={config:{owner:null,botName:null,isBotOnline:!1},login:null,touchedCollapsibles:[],streamPreviewActive:!1,informationActive:pBotStorage.get(pBotStorage.keys.informationActive,!0),tooltipsActive:pBotStorage.get(pBotStorage.keys.tooltipsActive,!0),musicPlayerControls:{controlsEnabled:pBotStorage.get(pBotStorage.keys.musicPlayer.controlsEnabled),volume:pBotStorage.get(pBotStorage.keys.musicPlayer.volume,100),volumeDivision:pBotStorage.get(pBotStorage.keys.musicPlayer.volumeDivisionEnabled),updateIntervalId:-1}};$(window).ready(function(){pBotData.login=pBotStorage.get(pBotStorage.keys.panelLogin),pBotData.login&&(getPanelConfig(),setBotStatus(),bindGlobalEventHandlers(),updateFavoritesMenu(),loadPartFromStorage(),setInterval(function(){loadChannelData(),setBotStatus()},6e5))});
//# sourceMappingURL=app.min.js.map