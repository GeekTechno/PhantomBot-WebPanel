var pBotStorage={keys:{twitchCache:"pbot-twitch-cache",chatDefaultState:"pbot-chat-state",panelLogin:"pbot-login",lastUsedPart:"pbot-last-used-part",favoritesMenuItems:"pbot-favorites-menu-items",informationActive:"pbot-information-active",tooltipsActive:"pbot-tooltips-active",musicPlayer:{volume:"pbot-music-player-volume",controlsEnabled:"pbot-music-player-controls"}},set:function(t,e){localStorage.setItem(t,JSON.stringify(e))},get:function(t,e){return localStorage.getItem(t)?JSON.parse(localStorage.getItem(t)):e?e:false}},pBotData={config:{owner:"",botName:"",isBotOnline:false,token:""},login:null,touchedCollapsibles:[],streamPreviewActive:false,informationActive:pBotStorage.get(pBotStorage.keys.informationActive,true),tooltipsActive:pBotStorage.get(pBotStorage.keys.tooltipsActive,true),musicPlayerControls:{controlsEnabled:pBotStorage.get(pBotStorage.keys.musicPlayer.controlsEnabled),updateIntervalId:-1}};$(window).ready(function(){pBotData.login=pBotStorage.get(pBotStorage.keys.panelLogin);if(pBotData.login){$("#current-user").text(pBotData.login.username);getPanelConfig();getBotStatus();bindGlobalEventHandlers();updateFavoritesMenu();setInterval(function(){loadChannelData();getBotStatus()},6e5)}else{logOut()}});function applyChannelData(t){if(t.stream!=null){$("#stream-status").text("Online");if(!t.stream.hasOwnProperty("viewers")){t.stream.viewers=0}$("#stream-viewer-count").text(t.stream.viewers)}$("#stream-title").text(t.channel.status);if(!t.channel.hasOwnProperty("game")){t.channel.game=""}$("#stream-game").text(t.channel.game);if(!t.followers.hasOwnProperty("_total")){t.followers._total=0}$("#stream-followers").text(t.followers._total);doBotRequest("getIniValueByKey",function(t){if(t!="0"){$("#stream-hosts").text(data[0])}},{uri:"stream_info",key:"hosts_amount"})}function bindGlobalEventHandlers(){bindContextMenu();$(".dropdown-toggle").on("click",function(){var t=$(this),e=t.next(".dropdown-menu"),a,o=300;if(e.css("display")=="block"){e.fadeOut(o)}else{$(".dropdown-menu").fadeOut(o);if(e.hasClass("drop-up")){e.fadeIn(o)}else{e.fadeIn(o).on("click mouseleave",function(){a=setTimeout(function(){e.fadeOut(o).off("click mouseleave mouseenter")},300)}).on("mouseenter",function(){clearTimeout(a)})}}});$("#volume-control-slider").slider({min:0,max:100,value:pBotStorage.get(pBotStorage.keys.musicPlayer.volume,100),change:function(t,e){pBotStorage.set(pBotStorage.keys.musicPlayer.volume,e.value);doQuickCommand("volume "+e.value)}});$(".side-tab").on("click",sideTabTabHandler)}function bindPartEventHandlers(){$("form.bot-command-form").off("submit").on("submit",function(t){var e;if(!t.target.attributes.hasOwnProperty("botcommand")){t.target.attributes.botcommand={value:""}}var a=$(t.target[0]),o=$(t.target[1]),n=o.html(),s=t.target.attributes.formnoreload.value;if(a.val().length!=0){if(t.target.attributes.botcommand.value==""){e={command:_cleanInput(a.val())}}else{e={command:_cleanInput(t.target.attributes.botcommand.value)+" "+_cleanInput(a.val())}}o.html('<span class="fa fa-cog fa-spin"></span>');doBotRequest("command",function(t){showGeneralAlert(t);if(s=="1"){a.val("");o.html(n)}else{loadPartFromStorage()}},e)}else{showGeneralAlert()}t.preventDefault()});$("form.combined-bot-command-form").off("submit").on("submit",function(t){var e=t.target.attributes.botcommand.value,a=t.target[0].selectedOptions[0].value,o=t.target[1].value,n=t.target.attributes.formnoreload.value=="1",s;if(o!=""){s={command:(e!=""?e+" ":"")+a+" "+o};doBotRequest("command",function(e){showGeneralAlert(e,"success");if(n){$(t.target[1]).val("")}else{loadPartFromStorage()}},s)}else{showGeneralAlert()}t.preventDefault()});$("form#sfx-selection").off("submit").on("submit",function(t){var e=t.target[0].selectedOptions[0].value,a=t.target[1].value;if(e&&e!=""&&a!=""){doBotRequest("saveSfxCommand",function(){loadPartFromStorage()},{command:_cleanInput(a),file:e})}debug(a,e);t.preventDefault()});$(".collapsible-master").on("click",function(){var t=$(this),e=t.next(".collapsible-content");if(e.hasClass("disabled")){showGeneralAlert("This feature us currently disabled","warning");return}if(t.hasClass("open")){e.fadeOut(300);for(var a in pBotData.touchedCollapsibles){if(pBotData.touchedCollapsibles[a]==t.text()){pBotData.touchedCollapsibles.splice(a,1)}}}else{e.fadeIn(300);pBotData.touchedCollapsibles.push(t.text())}t.toggleClass("open")});for(var t in pBotData.touchedCollapsibles){$(".collapsible-master:contains("+pBotData.touchedCollapsibles[t]+")").toggleClass("open").next(".collapsible-content").fadeIn(300)}toggleTooltips(true);toggleInformationPanels(true)}function channelDataCache(t){if(t){t.pbotCacheEndTime=Date.now()+3e5;pBotStorage.set(pBotStorage.keys.twitchCache,t)}else{return pBotStorage.get(pBotStorage.keys.twitchCache,false)}}function doBotRequest(t,e,a){if(!pBotData.config.isBotOnline){return}$.ajax({type:"POST",url:"app/connectors/connect.php",data:$.extend({action:t},a,pBotData.login),dataType:"json",success:function(t){if(t[1]==200){if(e){e.apply(this,[t[0],t[1]])}}else{showGeneralAlert("Bot Request failed!","danger");console.log("Bot Request failed...",t)}}})}function doQuickCommand(t,e,a){if(e&&e!=""){if(!confirm(e)){return}}doBotRequest("command",function(t){showGeneralAlert(t);if(!a){loadPartFromStorage()}},{command:_cleanInput(t)})}function getPanelConfig(){$.ajax({type:"POST",url:"app/connectors/connect.php",data:$.extend({action:"getConfig"},pBotData.login),dataType:"json",success:function(t){if(t[1]==200){pBotData.config=t[0];loadChannelData();toggleMusicPlayerControls(true);toggleTooltips(true);toggleChat(true);loadPartFromStorage()}else{showLoginAlert(t[3])}}})}function loadChannelData(t){var e=channelDataCache();if(!t&&e&&e.pbotCacheEndTime>Date.now()){console.log("Stream info loaded from local cache!",e);applyChannelData(e)}else{var a={stream:null,channel:null,followers:null};$.ajax({url:"https://api.twitch.tv/kraken/channels/"+pBotData.config.owner+"/follows?limit=1",type:"GET",dataType:"json",success:function(t){a.followers=t;$.ajax({url:"https://api.twitch.tv/kraken/streams/"+pBotData.config.owner,type:"GET",dataType:"json",success:function(t){if(t.stream!=null){a.stream=t.stream;a.channel=t.stream.channel;channelDataCache(a);applyChannelData(a)}else{$.ajax({url:"https://api.twitch.tv/kraken/channels/"+pBotData.config.owner,type:"GET",dataType:"json",success:function(t){a.channel=t;channelDataCache(a);applyChannelData(a)}})}}})}})}}function loadPartFromStorage(){var t=pBotStorage.get(pBotStorage.keys.lastUsedPart,"static/dashboard.php");setActiveMenuItem(t);$("#part-window").load("app/parts/"+t,{token:pBotData.config.token,username:pBotData.login.username},bindPartEventHandlers)}function logOut(){localStorage.removeItem(pBotStorage.keys.twitchCache);localStorage.removeItem(pBotStorage.keys.panelLogin);location.replace("index.php")}function openPart(t,e){var a=$("#part-window");pBotData.touchedCollapsibles=[];setActiveMenuItem(t);a.load("app/parts/static/loading.html",null,function(){if(e){a.load("app/parts/"+t,$.extend(e,{token:pBotData.config.token,username:pBotData.login.username}),bindPartEventHandlers)}else{a.load("app/parts/"+t,{token:pBotData.config.token,username:pBotData.login.username},bindPartEventHandlers)}pBotStorage.set(pBotStorage.keys.lastUsedPart,t)})}function saveToConfig(t,e,a){var o=$("#"+e).val();doBotRequest("saveToConfig",function(t){console.log(t);$(a).removeClass("btn-primary").addClass("btn-success").text("Saved").prop("disabled",true);var e=setTimeout(function(){$(a).removeClass("btn-success").addClass("btn-primary").text("Save").prop("disabled",false);clearTimeout(e)},3e3)},{settingPath:t,setting:o.trim()})}function setActiveMenuItem(t){$(".active").removeClass("active");$("#menu-parent-"+t.replace("static/","").replace(/([a-z]+).*/i,"$1")).addClass("active");$("#menu-favorites-"+t.replace(/.*\/|-|\.php/gi,"")).addClass("active")}function sideTabTabHandler(t){var e=$(t.target),a=e.parent(),o=a.find("iframe"),n=a.find("button");a.toggleClass("open");e.toggleClass("active");if(n.length>0){n.off("click").on("click",function(){if(n.hasClass("btn-success")){o.attr("src",e.attr("tab-src"))}else{o.attr("src","")}e.toggleClass("pulse");n.toggleClass("btn-success").toggleClass("btn-danger");n.find("span").toggleClass("fa-check").toggleClass("fa-close");a.find(".notice").toggleClass("hidden")})}else{if(a.hasClass("open")){o.attr("src",e.attr("tab-src"))}else{o.attr("src","")}}}function getBotStatus(){$.ajax({type:"POST",url:"app/connectors/connect.php",data:$.extend({action:"testBotConnection"},pBotData.login),dataType:"json",success:function(t){if(t[2]==52){pBotData.config.isBotOnline=true}else{console.warn("Bot is offline!\nDisabling bot requests...\nChecking again in 10 minutes...\n"+t[3])}}})}function bindContextMenu(t){var e=$("body"),a=pBotStorage.get(pBotStorage.keys.favoritesMenuItems,[]),o=[{title:"Quick Access"},{title:"Dashboard",cmd:"part:static/dashboard.php"}];a.sort(function(t,e){return t.itemName>e.itemName});for(var n in a){o.push({title:a[n].itemName,cmd:"part:"+a[n].itemPath})}o.push({title:"Toggle Chat",cmd:"func:toggleChat"},{title:"Toggle Player Controls",cmd:"func:toggleMusicPlayerControls"});if(t){e.contextmenu("replaceMenu",o)}else{e.contextmenu({menu:o,select:function(t,e){if(e.cmd){if(e.cmd.match(/^func:/)){window[e.cmd.replace("func:","")]()}if(e.cmd.match(/^part:/)){window.scrollTo(0,0);openPart(e.cmd.replace("part:",""))}}}})}}function showGeneralAlert(t,e){var a=$("#general-alert");if(!t){t="You forgot to enter a value!"}if(!e){e="info"}a.addClass("alert-"+e).text(t).fadeIn(500);var o=setTimeout(function(){a.animate({right:"-100%"},{duration:1500,complete:function(){$(this).hide().css({right:"1em"}).removeClass("alert-"+e)}});clearTimeout(o)},3e3)}function toggleInformationPanels(t){var e=$(".information-panel");if(t){e.toggleClass("hidden",!pBotData.informationActive)}else{pBotData.informationActive=!pBotData.informationActive;e.toggleClass("hidden",pBotData.informationActive);pBotStorage.set(pBotStorage.keys.informationActive,pBotData.informationActive);loadPartFromStorage()}}function toggleMusicPlayerControls(t,e){if(t){}else{pBotData.musicPlayerControls.controlsEnabled=!pBotData.musicPlayerControls.controlsEnabled;pBotStorage.set(pBotStorage.keys.musicPlayer.controlsEnabled,pBotData.musicPlayerControls.controlsEnabled)}var a=$("body"),o="music-controls-enabled";if(!pBotData.musicPlayerControls.controlsEnabled){if(pBotData.musicPlayerControls.updateIntervalId!=-1){clearInterval(pBotData.musicPlayerControls.updateIntervalId)}a.removeClass(o);$(e).html('<span class="fa fa-eject"></span>&nbsp;Show Music Player Controls')}else{a.addClass(o);pBotData.musicPlayerControls.updateIntervalId=setInterval(updateMusicPlayerState,5e3);$(e).html('<span class="fa fa-eject text-success"></span>&nbsp;Hide Music Player Controls')}}function toggleTooltips(t){if(t){bindTooltips(pBotData.tooltipsActive)}else{bindTooltips(pBotData.tooltipsActive);pBotData.tooltipsActive=!pBotData.tooltipsActive;pBotStorage.set(pBotStorage.keys.tooltipsActive,pBotData.tooltipsActive);loadPartFromStorage()}}function toggleChat(t){var e=$("body"),a=$("#chat-iframe"),o="chat-enabled",n=e.hasClass(o);if(t){if(pBotStorage.get(pBotStorage.keys.chatDefaultState)){e.addClass(o);a.attr("src","http://www.twitch.tv/"+pBotData.config.owner+"/chat?popout=")}return}if(n){e.removeClass(o);a.attr("src","")}else{e.addClass(o);a.attr("src","http://www.twitch.tv/"+pBotData.config.owner+"/chat?popout=")}}function toggleChatDefaultState(){var t=!pBotStorage.get(pBotStorage.keys.chatDefaultState);pBotStorage.set(pBotStorage.keys.chatDefaultState,t)}function updateFavoritesMenu(t,e){var a=pBotStorage.get(pBotStorage.keys.favoritesMenuItems,[]);if(t&&e){var o;for(var n in a){if(a[n].itemName==t){o=true;a.splice(n,1)}}if(!o){a.push({itemName:t,itemPath:e})}pBotStorage.set(pBotStorage.keys.favoritesMenuItems,a);setTimeout(updateFavoritesMenu,10)}else{var s=$("#favorites-menu");s.children(".favorites-item").each(function(t,e){$(e).remove()});for(n in a){s.append($('<li class="favorites-item" id="menu-favorites-'+a[n].itemName.replace(" ","").toLocaleLowerCase()+'"><a nohref onclick="openPart(\''+a[n].itemPath+'\')" role="button">'+a[n].itemName+"</a></li>"))}}bindContextMenu(true)}function updateMusicPlayerState(){if(pBotData.musicPlayerControls.controlsEnabled){doBotRequest("getCurrentTitle",function(t){$("#current-video-title").html(t)})}}function togglePlayPause(){doBotRequest("command",function(t){showGeneralAlert(t,"success")},{command:"pause"})}function toggleSfx(t){debug(t);doBotRequest("saveToConfig",function(){loadPartFromStorage()},{settingPath:"misc/sfxEnabled",setting:t.toString()})}function deleteSfx(t){doBotRequest("deleteSfxCommand",function(){loadPartFromStorage()},{command:t})}function openPopup(t,e,a){if(!e){e="PhantomBot WebPanel"}if(!a){a="width=800,height=600"}window.open(t,e,a)}function _cleanInput(t){var e=[/^!/],a=[""],o;for(o in e){t=t.replace(e[o],a[o])}return t}function debug(){console.log.apply(console,arguments)}
//# sourceMappingURL=app.min.map